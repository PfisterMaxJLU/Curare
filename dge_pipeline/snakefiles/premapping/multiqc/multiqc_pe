from os import listdir
from os.path import isfile, basename, splitext

rule all:
    input:
        "premapping/multiqc/multiqc_report.html"

rule fastqc:
    input:
        "preprocessing/{A}.fastq"
    output:
        "premapping/multiqc/fastqc/{A}_fastqc.html",
        "premapping/multiqc/fastqc/{A}_fastqc.zip"
    threads:
        1
    shell:
        "fastqc -o premapping/multiqc/fastqc {input}"

rule multiqc:
    input:
        expand("premapping/multiqc/fastqc/{A}_fastqc.html", A=[splitext(basename(seqRun['main'][column_name]))[0] for seqRun in config['entries'].values() for column_name in seqRun['main'].keys() if column_name in ('forward_reads', 'reverse_reads')])
    output:
        "premapping/multiqc/multiqc_report.html"
    params:
        input_dir="premapping/multiqc/fastqc"
    threads:
        1
    shell:
        "multiqc -o premapping/multiqc {params.input_dir}"
