from os import listdir
from os.path import isfile

rule all:
    input:
        "analyses/count_table/counts.txt"

rule count_reads:
    input:
        expand("mapping/{A}.bam", A=config['entries'].keys())
    output:
        "analyses/count_table/counts.txt"
    conda:
        "../lib/conda_env.yaml"
    group:
        "count_reads"
    log:
        log="analyses/count_table/logs/featurecounts.log"
    threads:
        1
    shell:
        "featureCounts -T 4 %%ADDITIONAL_OPTIONS%% -t '%%GFF_FEATURE_TYPE%%' -g '%%GFF_FEATURE_NAME%%' -a %%GFF_PATH%% -o {output} {input} 2>&1 |"
        "tee {log}"
